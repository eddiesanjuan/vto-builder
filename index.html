<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTO Builder - Vision/Traction Organizer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f8fafc;
            --card-bg: #ffffff;
            --border: #e2e8f0;
            --text: #1e293b;
            --text-light: #64748b;
            --radius: 8px;
            --shadow: 0 1px 3px rgba(0,0,0,0.1), 0 1px 2px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
        }

        /* Header */
        header {
            background: var(--card-bg);
            border-bottom: 1px solid var(--border);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: var(--shadow);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
        }

        .logo span {
            color: var(--text);
            font-weight: 400;
        }

        .header-actions {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        /* Format selector */
        .format-selector {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-right: 0.5rem;
        }

        .format-selector label {
            font-size: 0.875rem;
            font-weight: 500;
            color: var(--text-light);
            margin: 0;
        }

        .format-selector select {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.875rem;
            background: var(--card-bg);
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.15s ease;
            border: 1px solid transparent;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
        }

        .btn-secondary {
            background: var(--card-bg);
            color: var(--text);
            border-color: var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        /* Main Layout */
        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.25rem;
            margin-bottom: 2rem;
            border-bottom: 2px solid var(--border);
            padding-bottom: 0;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
            color: var(--text-light);
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
            transition: all 0.15s ease;
        }

        .tab:hover {
            color: var(--primary);
        }

        .tab.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Cards/Sections */
        .section {
            background: var(--card-bg);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: var(--shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border);
        }

        .section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text);
        }

        .section-subtitle {
            font-size: 0.875rem;
            color: var(--text-light);
            margin-top: 0.25rem;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 1rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        label {
            display: block;
            font-size: 0.875rem;
            font-weight: 500;
            margin-bottom: 0.375rem;
            color: var(--text);
        }

        input[type="text"],
        input[type="date"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 0.625rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 0.9375rem;
            transition: border-color 0.15s ease, box-shadow 0.15s ease;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Dynamic Lists */
        .list-container {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .list-item {
            display: flex;
            gap: 0.5rem;
            align-items: flex-start;
        }

        .list-item input,
        .list-item textarea {
            flex: 1;
        }

        .list-item .item-number {
            min-width: 1.75rem;
            height: 2.25rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-light);
            font-size: 0.875rem;
        }

        .list-item .btn-remove {
            padding: 0.5rem;
            color: var(--danger);
            background: transparent;
            border: none;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.15s ease;
        }

        .list-item .btn-remove:hover {
            opacity: 1;
        }

        .btn-add {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            color: var(--primary);
            background: transparent;
            border: 1px dashed var(--primary);
            border-radius: var(--radius);
            cursor: pointer;
            margin-top: 0.5rem;
            transition: all 0.15s ease;
        }

        .btn-add:hover {
            background: rgba(37, 99, 235, 0.05);
        }

        /* Rock Items with Owner */
        .rock-item {
            display: grid;
            grid-template-columns: 1.75rem 1fr 150px 32px;
            gap: 0.5rem;
            align-items: flex-start;
        }

        /* Issue Items with Status */
        .issue-item {
            display: grid;
            grid-template-columns: 1.75rem 1fr 140px 32px;
            gap: 0.5rem;
            align-items: flex-start;
        }

        .issue-item select {
            padding: 0.5rem;
            font-size: 0.8125rem;
        }

        /* Company Info */
        .company-section {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .company-section label {
            color: rgba(255,255,255,0.9);
        }

        .company-section input {
            background: rgba(255,255,255,0.95);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: var(--text);
            color: white;
            border-radius: var(--radius);
            box-shadow: var(--shadow-lg);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.success {
            background: var(--success);
        }

        .toast.error {
            background: var(--danger);
        }

        /* Hidden file input */
        .file-input {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            header {
                padding: 1rem;
            }

            .header-content {
                flex-direction: column;
                align-items: stretch;
            }

            .header-actions {
                justify-content: center;
            }

            main {
                padding: 1rem;
            }

            .tabs {
                overflow-x: auto;
                flex-wrap: nowrap;
            }

            .tab {
                padding: 0.5rem 1rem;
                white-space: nowrap;
            }

            .rock-item,
            .issue-item {
                grid-template-columns: 1.5rem 1fr 32px;
            }

            .rock-item input:nth-child(3),
            .issue-item select {
                grid-column: 2 / 3;
                grid-row: 2;
            }
        }

        /* Print styles */
        @media print {
            header, .tabs, .btn {
                display: none !important;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">VTO<span>Builder</span></div>
            <div class="header-actions">
                <div class="format-selector">
                    <label for="pdfFormat">PDF Format:</label>
                    <select id="pdfFormat">
                        <option value="letter">Letter (11 x 8.5)</option>
                        <option value="ipad">iPad 11" (9.5 x 7)</option>
                    </select>
                </div>
                <button class="btn btn-secondary" onclick="saveToLocalStorage()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                    Save
                </button>
                <button class="btn btn-secondary" onclick="exportJSON()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                    Export JSON
                </button>
                <button class="btn btn-secondary" onclick="document.getElementById('importFile').click()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                    Import JSON
                </button>
                <input type="file" id="importFile" class="file-input" accept=".json" onchange="importJSON(event)">
                <button class="btn btn-primary" onclick="exportPDF()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
                    Export PDF
                </button>
                <button class="btn btn-danger" onclick="clearAll()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                    Clear
                </button>
            </div>
        </div>
    </header>

    <main>
        <!-- Company Info -->
        <div class="company-section">
            <div class="form-row">
                <div class="form-group">
                    <label for="companyName">Company Name</label>
                    <input type="text" id="companyName" placeholder="Your Company Name">
                </div>
                <div class="form-group">
                    <label for="vtoDate">VTO Date</label>
                    <input type="date" id="vtoDate">
                </div>
            </div>
        </div>

        <!-- Tabs -->
        <div class="tabs">
            <div class="tab active" data-tab="vision">Page 1: Vision</div>
            <div class="tab" data-tab="traction">Page 2: Traction</div>
        </div>

        <!-- Vision Tab -->
        <div id="vision" class="tab-content active">
            <!-- Core Values -->
            <div class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Core Values</h2>
                        <p class="section-subtitle">The 4-6 values that define your company culture</p>
                    </div>
                </div>
                <div id="coreValuesList" class="list-container"></div>
                <button class="btn-add" onclick="addListItem('coreValuesList', 'coreValues')">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Add Core Value
                </button>
            </div>

            <!-- Core Focus -->
            <div class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Core Focus</h2>
                        <p class="section-subtitle">Your purpose and niche</p>
                    </div>
                </div>
                <div class="form-group">
                    <label for="purpose">Purpose / Cause / Passion</label>
                    <textarea id="purpose" rows="2" placeholder="Why does your company exist?"></textarea>
                </div>
                <div class="form-group">
                    <label for="niche">Our Niche</label>
                    <textarea id="niche" rows="2" placeholder="What you do better than anyone"></textarea>
                </div>
            </div>

            <!-- 10-Year Target -->
            <div class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">10-Year Target</h2>
                        <p class="section-subtitle">Your long-term, ambitious goal (BHAG)</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="tenYearDate">Target Date</label>
                        <input type="date" id="tenYearDate">
                    </div>
                </div>
                <div class="form-group">
                    <label for="tenYearTarget">10-Year Target</label>
                    <textarea id="tenYearTarget" rows="2" placeholder="Your Big Hairy Audacious Goal"></textarea>
                </div>
            </div>

            <!-- 3-Year Picture -->
            <div class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">3-Year Picture</h2>
                        <p class="section-subtitle">What does the company look like in 3 years?</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="threeYearDate">Future Date</label>
                        <input type="date" id="threeYearDate">
                    </div>
                    <div class="form-group">
                        <label for="threeYearRevenue">Revenue</label>
                        <input type="text" id="threeYearRevenue" placeholder="$X,XXX,XXX">
                    </div>
                    <div class="form-group">
                        <label for="threeYearProfit">Profit</label>
                        <input type="text" id="threeYearProfit" placeholder="$XXX,XXX or XX%">
                    </div>
                </div>
                <div class="form-group">
                    <label>What Does It Look Like?</label>
                    <div id="threeYearBulletsList" class="list-container"></div>
                    <button class="btn-add" onclick="addListItem('threeYearBulletsList', 'threeYearBullets')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Bullet Point
                    </button>
                </div>
            </div>

            <!-- Marketing Strategy -->
            <div class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Marketing Strategy</h2>
                        <p class="section-subtitle">Your target market and differentiators</p>
                    </div>
                </div>

                <div class="form-group">
                    <label>Target Market</label>
                    <p class="section-subtitle" style="margin-bottom: 0.75rem;">Demographics, Geographics, Psychographics</p>
                    <div id="targetMarketList" class="list-container"></div>
                    <button class="btn-add" onclick="addListItem('targetMarketList', 'targetMarket')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Target Market
                    </button>
                </div>

                <div class="form-group">
                    <label>Three Uniques</label>
                    <p class="section-subtitle" style="margin-bottom: 0.75rem;">What makes you different from competitors</p>
                    <div id="threeUniquesList" class="list-container"></div>
                    <button class="btn-add" onclick="addListItem('threeUniquesList', 'threeUniques')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Unique
                    </button>
                </div>

                <div class="form-group">
                    <label for="provenProcess">Proven Process</label>
                    <textarea id="provenProcess" rows="2" placeholder="Your proprietary process name or description"></textarea>
                </div>

                <div class="form-group">
                    <label for="guarantee">Guarantee</label>
                    <textarea id="guarantee" rows="2" placeholder="Your guarantee to customers"></textarea>
                </div>
            </div>
        </div>

        <!-- Traction Tab -->
        <div id="traction" class="tab-content">
            <!-- 1-Year Plan -->
            <div class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">1-Year Plan</h2>
                        <p class="section-subtitle">Goals and targets for the next 12 months</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="oneYearDate">Future Date</label>
                        <input type="date" id="oneYearDate">
                    </div>
                    <div class="form-group">
                        <label for="oneYearRevenue">Revenue</label>
                        <input type="text" id="oneYearRevenue" placeholder="$X,XXX,XXX">
                    </div>
                    <div class="form-group">
                        <label for="oneYearProfit">Profit</label>
                        <input type="text" id="oneYearProfit" placeholder="$XXX,XXX or XX%">
                    </div>
                </div>
                <div class="form-group">
                    <label>Goals for the Year</label>
                    <div id="oneYearGoalsList" class="list-container"></div>
                    <button class="btn-add" onclick="addListItem('oneYearGoalsList', 'oneYearGoals')">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Goal
                    </button>
                </div>
                <div class="form-group">
                    <label for="oneYearTheme">Theme (Optional)</label>
                    <input type="text" id="oneYearTheme" placeholder="e.g., 'Year of Growth'">
                </div>
            </div>

            <!-- Quarterly Rocks -->
            <div class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Quarterly Rocks</h2>
                        <p class="section-subtitle">3-7 most important things to accomplish this quarter</p>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="rocksDate">Quarter End Date</label>
                        <input type="date" id="rocksDate">
                    </div>
                    <div class="form-group">
                        <label for="rocksRevenue">Revenue (Optional)</label>
                        <input type="text" id="rocksRevenue" placeholder="$X,XXX,XXX">
                    </div>
                    <div class="form-group">
                        <label for="rocksProfit">Profit (Optional)</label>
                        <input type="text" id="rocksProfit" placeholder="$XXX,XXX or XX%">
                    </div>
                </div>
                <div class="form-group">
                    <label>Rocks</label>
                    <div id="rocksList" class="list-container"></div>
                    <button class="btn-add" onclick="addRockItem()">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                        Add Rock
                    </button>
                </div>
                <div class="form-group">
                    <label for="rocksTheme">Theme (Optional)</label>
                    <input type="text" id="rocksTheme" placeholder="e.g., 'Q1 Focus'">
                </div>
            </div>

            <!-- Issues List -->
            <div class="section">
                <div class="section-header">
                    <div>
                        <h2 class="section-title">Issues List (Parking Lot)</h2>
                        <p class="section-subtitle">Long-term issues to be addressed</p>
                    </div>
                </div>
                <div id="issuesList" class="list-container"></div>
                <button class="btn-add" onclick="addIssueItem()">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
                    Add Issue
                </button>
            </div>
        </div>
    </main>

    <div id="toast" class="toast"></div>

    <script>
        // Default data structure
        function getDefaultData() {
            return {
                companyName: '',
                vtoDate: '',
                coreValues: [],
                purpose: '',
                niche: '',
                tenYearDate: '',
                tenYearTarget: '',
                threeYearDate: '',
                threeYearRevenue: '',
                threeYearProfit: '',
                threeYearBullets: [],
                targetMarket: [],
                threeUniques: [],
                provenProcess: '',
                guarantee: '',
                oneYearDate: '',
                oneYearRevenue: '',
                oneYearProfit: '',
                oneYearGoals: [],
                oneYearTheme: '',
                rocksDate: '',
                rocksRevenue: '',
                rocksProfit: '',
                rocks: [],
                rocksTheme: '',
                issues: []
            };
        }

        let vtoData = getDefaultData();

        // Tab handling
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Initialize lists
        function initializeLists() {
            ['coreValues', 'threeYearBullets', 'targetMarket', 'threeUniques', 'oneYearGoals'].forEach(key => {
                if (!Array.isArray(vtoData[key]) || vtoData[key].length === 0) {
                    vtoData[key] = [''];
                }
                renderList(key + 'List', key);
            });

            if (!Array.isArray(vtoData.rocks) || vtoData.rocks.length === 0) {
                vtoData.rocks = [{ text: '', owner: '' }];
            }
            renderRocksList();

            if (!Array.isArray(vtoData.issues) || vtoData.issues.length === 0) {
                vtoData.issues = [{ text: '', status: '' }];
            }
            renderIssuesList();
        }

        // Render simple list
        function renderList(containerId, dataKey) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';

            vtoData[dataKey].forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'list-item';
                div.innerHTML = `
                    <span class="item-number">${index + 1}.</span>
                    <input type="text" value="${escapeHtml(item)}"
                           onchange="updateListItem('${dataKey}', ${index}, this.value)"
                           placeholder="Enter value...">
                    <button class="btn-remove" onclick="removeListItem('${dataKey}', ${index}, '${containerId}')" title="Remove">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                `;
                container.appendChild(div);
            });
        }

        // Render rocks list
        function renderRocksList() {
            const container = document.getElementById('rocksList');
            container.innerHTML = '';

            vtoData.rocks.forEach((rock, index) => {
                const div = document.createElement('div');
                div.className = 'rock-item';
                div.innerHTML = `
                    <span class="item-number">${index + 1}.</span>
                    <input type="text" value="${escapeHtml(rock.text || '')}"
                           onchange="updateRock(${index}, 'text', this.value)"
                           placeholder="Rock description...">
                    <input type="text" value="${escapeHtml(rock.owner || '')}"
                           onchange="updateRock(${index}, 'owner', this.value)"
                           placeholder="Owner">
                    <button class="btn-remove" onclick="removeRock(${index})" title="Remove">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                `;
                container.appendChild(div);
            });
        }

        // Render issues list
        function renderIssuesList() {
            const container = document.getElementById('issuesList');
            container.innerHTML = '';

            vtoData.issues.forEach((issue, index) => {
                const div = document.createElement('div');
                div.className = 'issue-item';
                const status = issue.status || '';
                div.innerHTML = `
                    <span class="item-number">${index + 1}.</span>
                    <input type="text" value="${escapeHtml(issue.text || '')}"
                           onchange="updateIssue(${index}, 'text', this.value)"
                           placeholder="Issue description...">
                    <select onchange="updateIssue(${index}, 'status', this.value)">
                        <option value="" ${status === '' ? 'selected' : ''}>No Status</option>
                        <option value="IN PROGRESS" ${status === 'IN PROGRESS' ? 'selected' : ''}>In Progress</option>
                        <option value="DONE" ${status === 'DONE' ? 'selected' : ''}>Done</option>
                        <option value="NEED" ${status === 'NEED' ? 'selected' : ''}>Need</option>
                    </select>
                    <button class="btn-remove" onclick="removeIssue(${index})" title="Remove">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                    </button>
                `;
                container.appendChild(div);
            });
        }

        // List operations
        function addListItem(containerId, dataKey) {
            vtoData[dataKey].push('');
            renderList(containerId, dataKey);
            const container = document.getElementById(containerId);
            const inputs = container.querySelectorAll('input');
            inputs[inputs.length - 1].focus();
        }

        function updateListItem(dataKey, index, value) {
            vtoData[dataKey][index] = value;
        }

        function removeListItem(dataKey, index, containerId) {
            if (vtoData[dataKey].length > 1) {
                vtoData[dataKey].splice(index, 1);
                renderList(containerId, dataKey);
            }
        }

        // Rock operations
        function addRockItem() {
            vtoData.rocks.push({ text: '', owner: '' });
            renderRocksList();
            const container = document.getElementById('rocksList');
            const inputs = container.querySelectorAll('input[placeholder="Rock description..."]');
            inputs[inputs.length - 1].focus();
        }

        function updateRock(index, field, value) {
            vtoData.rocks[index][field] = value;
        }

        function removeRock(index) {
            if (vtoData.rocks.length > 1) {
                vtoData.rocks.splice(index, 1);
                renderRocksList();
            }
        }

        // Issue operations
        function addIssueItem() {
            vtoData.issues.push({ text: '', status: '' });
            renderIssuesList();
            const container = document.getElementById('issuesList');
            const inputs = container.querySelectorAll('input');
            inputs[inputs.length - 1].focus();
        }

        function updateIssue(index, field, value) {
            vtoData.issues[index][field] = value;
        }

        function removeIssue(index) {
            if (vtoData.issues.length > 1) {
                vtoData.issues.splice(index, 1);
                renderIssuesList();
            }
        }

        // Collect form data from inputs
        function collectFormData() {
            vtoData.companyName = document.getElementById('companyName').value;
            vtoData.vtoDate = document.getElementById('vtoDate').value;
            vtoData.purpose = document.getElementById('purpose').value;
            vtoData.niche = document.getElementById('niche').value;
            vtoData.tenYearDate = document.getElementById('tenYearDate').value;
            vtoData.tenYearTarget = document.getElementById('tenYearTarget').value;
            vtoData.threeYearDate = document.getElementById('threeYearDate').value;
            vtoData.threeYearRevenue = document.getElementById('threeYearRevenue').value;
            vtoData.threeYearProfit = document.getElementById('threeYearProfit').value;
            vtoData.provenProcess = document.getElementById('provenProcess').value;
            vtoData.guarantee = document.getElementById('guarantee').value;
            vtoData.oneYearDate = document.getElementById('oneYearDate').value;
            vtoData.oneYearRevenue = document.getElementById('oneYearRevenue').value;
            vtoData.oneYearProfit = document.getElementById('oneYearProfit').value;
            vtoData.oneYearTheme = document.getElementById('oneYearTheme').value;
            vtoData.rocksDate = document.getElementById('rocksDate').value;
            vtoData.rocksRevenue = document.getElementById('rocksRevenue').value;
            vtoData.rocksProfit = document.getElementById('rocksProfit').value;
            vtoData.rocksTheme = document.getElementById('rocksTheme').value;
        }

        // Collect list values directly from DOM (fixes bug #1: list edits lost on export)
        function collectListsFromDOM() {
            // Simple lists
            const listMappings = {
                'coreValuesList': 'coreValues',
                'threeYearBulletsList': 'threeYearBullets',
                'targetMarketList': 'targetMarket',
                'threeUniquesList': 'threeUniques',
                'oneYearGoalsList': 'oneYearGoals'
            };

            for (const [containerId, dataKey] of Object.entries(listMappings)) {
                const container = document.getElementById(containerId);
                if (container) {
                    const inputs = container.querySelectorAll('input[type="text"]');
                    vtoData[dataKey] = Array.from(inputs).map(input => input.value);
                }
            }

            // Rocks list
            const rocksContainer = document.getElementById('rocksList');
            if (rocksContainer) {
                const rockItems = rocksContainer.querySelectorAll('.rock-item');
                vtoData.rocks = Array.from(rockItems).map(item => {
                    const inputs = item.querySelectorAll('input[type="text"]');
                    return {
                        text: inputs[0] ? inputs[0].value : '',
                        owner: inputs[1] ? inputs[1].value : ''
                    };
                });
            }

            // Issues list
            const issuesContainer = document.getElementById('issuesList');
            if (issuesContainer) {
                const issueItems = issuesContainer.querySelectorAll('.issue-item');
                vtoData.issues = Array.from(issueItems).map(item => {
                    const input = item.querySelector('input[type="text"]');
                    const select = item.querySelector('select');
                    return {
                        text: input ? input.value : '',
                        status: select ? select.value : ''
                    };
                });
            }
        }

        // Populate form from data
        function populateForm() {
            document.getElementById('companyName').value = vtoData.companyName || '';
            document.getElementById('vtoDate').value = vtoData.vtoDate || '';
            document.getElementById('purpose').value = vtoData.purpose || '';
            document.getElementById('niche').value = vtoData.niche || '';
            document.getElementById('tenYearDate').value = vtoData.tenYearDate || '';
            document.getElementById('tenYearTarget').value = vtoData.tenYearTarget || '';
            document.getElementById('threeYearDate').value = vtoData.threeYearDate || '';
            document.getElementById('threeYearRevenue').value = vtoData.threeYearRevenue || '';
            document.getElementById('threeYearProfit').value = vtoData.threeYearProfit || '';
            document.getElementById('provenProcess').value = vtoData.provenProcess || '';
            document.getElementById('guarantee').value = vtoData.guarantee || '';
            document.getElementById('oneYearDate').value = vtoData.oneYearDate || '';
            document.getElementById('oneYearRevenue').value = vtoData.oneYearRevenue || '';
            document.getElementById('oneYearProfit').value = vtoData.oneYearProfit || '';
            document.getElementById('oneYearTheme').value = vtoData.oneYearTheme || '';
            document.getElementById('rocksDate').value = vtoData.rocksDate || '';
            document.getElementById('rocksRevenue').value = vtoData.rocksRevenue || '';
            document.getElementById('rocksProfit').value = vtoData.rocksProfit || '';
            document.getElementById('rocksTheme').value = vtoData.rocksTheme || '';
            initializeLists();
        }

        // Normalize imported data with defaults and type checks (fixes bug #3)
        function normalizeData(data) {
            const defaults = getDefaultData();
            const normalized = { ...defaults };

            for (const key in defaults) {
                if (data.hasOwnProperty(key)) {
                    const defaultVal = defaults[key];
                    const importedVal = data[key];

                    if (Array.isArray(defaultVal)) {
                        // Ensure arrays are arrays
                        if (Array.isArray(importedVal)) {
                            normalized[key] = importedVal;
                        }
                    } else if (typeof defaultVal === 'string') {
                        // Ensure strings are strings
                        normalized[key] = typeof importedVal === 'string' ? importedVal : String(importedVal || '');
                    } else {
                        normalized[key] = importedVal;
                    }
                }
            }

            // Normalize rocks array items
            if (Array.isArray(normalized.rocks)) {
                normalized.rocks = normalized.rocks.map(rock => ({
                    text: typeof rock === 'object' && rock !== null ? String(rock.text || '') : '',
                    owner: typeof rock === 'object' && rock !== null ? String(rock.owner || '') : ''
                }));
            }

            // Normalize issues array items
            if (Array.isArray(normalized.issues)) {
                normalized.issues = normalized.issues.map(issue => ({
                    text: typeof issue === 'object' && issue !== null ? String(issue.text || '') : '',
                    status: typeof issue === 'object' && issue !== null ? String(issue.status || '') : ''
                }));
            }

            return normalized;
        }

        // Save to localStorage
        function saveToLocalStorage() {
            collectFormData();
            collectListsFromDOM();
            localStorage.setItem('vtoData', JSON.stringify(vtoData));
            showToast('Saved to browser storage', 'success');
        }

        // Load from localStorage
        function loadFromLocalStorage() {
            const saved = localStorage.getItem('vtoData');
            if (saved) {
                try {
                    const parsed = JSON.parse(saved);
                    vtoData = normalizeData(parsed);
                    populateForm();
                } catch (e) {
                    console.error('Error loading saved data:', e);
                    initializeLists();
                }
            } else {
                initializeLists();
            }
        }

        // Sanitize filename (remove special chars, limit length)
        function sanitizeFilename(name) {
            if (!name) return 'export';
            return name
                .replace(/[^a-zA-Z0-9\s\-_]/g, '')
                .replace(/\s+/g, '-')
                .substring(0, 50)
                .replace(/-+$/, '') || 'export';
        }

        // Replace unicode chars with ASCII for PDF
        function toAscii(text) {
            if (!text) return '';
            return text
                // Smart quotes
                .replace(/[\u2018\u2019\u201A\u201B]/g, "'")
                .replace(/[\u201C\u201D\u201E\u201F]/g, '"')
                // Dashes
                .replace(/[\u2013\u2014]/g, '-')
                // Ellipsis
                .replace(/\u2026/g, '...')
                // Other common replacements
                .replace(/\u00A0/g, ' ')  // Non-breaking space
                .replace(/\u00AB/g, '<<')
                .replace(/\u00BB/g, '>>')
                .replace(/\u2022/g, '-')  // Bullet
                .replace(/\u00B7/g, '-')  // Middle dot
                .replace(/\u2019/g, "'"); // Right single quote
        }

        // Export JSON
        function exportJSON() {
            collectFormData();
            collectListsFromDOM();
            const dataStr = JSON.stringify(vtoData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            const safeName = sanitizeFilename(vtoData.companyName);
            a.download = `VTO-${safeName}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('JSON exported', 'success');
        }

        // Import JSON
        function importJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const parsed = JSON.parse(e.target.result);
                    vtoData = normalizeData(parsed);
                    populateForm();
                    showToast('VTO imported successfully', 'success');
                } catch (err) {
                    console.error('Import error:', err);
                    showToast('Invalid JSON file', 'error');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        // Clear all
        function clearAll() {
            if (confirm('Are you sure you want to clear all data? This cannot be undone.')) {
                vtoData = getDefaultData();
                vtoData.coreValues = [''];
                vtoData.threeYearBullets = [''];
                vtoData.targetMarket = [''];
                vtoData.threeUniques = [''];
                vtoData.oneYearGoals = [''];
                vtoData.rocks = [{ text: '', owner: '' }];
                vtoData.issues = [{ text: '', status: '' }];
                populateForm();
                localStorage.removeItem('vtoData');
                showToast('All data cleared', 'success');
            }
        }

        // Toast notification
        function showToast(message, type = '') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast ' + type;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        // Helper function
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text || '';
            return div.innerHTML;
        }

        // Format date for display - parse as local time to avoid timezone offset (fixes bug #2)
        function formatDate(dateStr) {
            if (!dateStr) return '';
            // Parse YYYY-MM-DD as local date, not UTC
            const parts = dateStr.split('-');
            if (parts.length !== 3) return dateStr;
            const year = parseInt(parts[0], 10);
            const month = parseInt(parts[1], 10) - 1; // JS months are 0-indexed
            const day = parseInt(parts[2], 10);
            const date = new Date(year, month, day);
            return date.toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' });
        }

        // PDF Export - Landscape with EOS VTO style
        function exportPDF() {
            // Collect ALL data including list DOM values
            collectFormData();
            collectListsFromDOM();

            const { jsPDF } = window.jspdf;
            const format = document.getElementById('pdfFormat').value;

            // Page dimensions in mm (landscape)
            let pageWidth, pageHeight;
            if (format === 'ipad') {
                // iPad 11" landscape: roughly 9.5 x 7 inches
                pageWidth = 241.3; // 9.5 inches
                pageHeight = 177.8; // 7 inches
            } else {
                // Letter landscape: 11 x 8.5 inches
                pageWidth = 279.4; // 11 inches
                pageHeight = 215.9; // 8.5 inches
            }

            const doc = new jsPDF({
                orientation: 'landscape',
                unit: 'mm',
                format: [pageWidth, pageHeight]
            });

            const margin = 10;
            const contentWidth = pageWidth - (margin * 2);
            const headerHeight = 12;

            // EOS VTO Colors
            const black = [0, 0, 0];
            const white = [255, 255, 255];
            const darkGray = [51, 51, 51];
            const medGray = [128, 128, 128];
            const lightGray = [240, 240, 240];
            const borderGray = [180, 180, 180];

            // Helper: draw section box with header
            function drawSection(title, x, y, width, height, content) {
                // Header bar
                doc.setFillColor(...black);
                doc.rect(x, y, width, 6, 'F');
                doc.setTextColor(...white);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'bold');
                doc.text(toAscii(title), x + 2, y + 4);

                // Content box
                doc.setFillColor(...white);
                doc.setDrawColor(...borderGray);
                doc.setLineWidth(0.3);
                doc.rect(x, y + 6, width, height - 6, 'FD');

                return y + 8; // Return Y position for content
            }

            // Helper: draw text with word wrap
            function drawText(text, x, y, maxWidth, fontSize = 8, isBold = false) {
                doc.setTextColor(...darkGray);
                doc.setFontSize(fontSize);
                doc.setFont('helvetica', isBold ? 'bold' : 'normal');
                const lines = doc.splitTextToSize(toAscii(text || ''), maxWidth);
                doc.text(lines, x, y);
                return y + (lines.length * (fontSize * 0.35));
            }

            // Helper: draw label
            function drawLabel(text, x, y) {
                doc.setTextColor(...medGray);
                doc.setFontSize(7);
                doc.setFont('helvetica', 'bold');
                doc.text(toAscii(text), x, y);
                return y + 3;
            }

            // Helper: draw bullet list
            function drawList(items, x, y, maxWidth, numbered = false) {
                doc.setTextColor(...darkGray);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'normal');
                let currentY = y;
                const filtered = (items || []).filter(item => item && String(item).trim());
                filtered.forEach((item, index) => {
                    const prefix = numbered ? `${index + 1}. ` : '- ';
                    const lines = doc.splitTextToSize(toAscii(prefix + item), maxWidth);
                    doc.text(lines, x, currentY);
                    currentY += lines.length * 3;
                });
                return currentY;
            }

            // ==================== PAGE 1: VISION ====================

            // Main header
            doc.setFillColor(...black);
            doc.rect(0, 0, pageWidth, headerHeight, 'F');
            doc.setTextColor(...white);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('VISION/TRACTION ORGANIZER', pageWidth / 2, 7, { align: 'center' });
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            const companyDisplay = toAscii(vtoData.companyName || 'Company Name');
            doc.text(companyDisplay, pageWidth / 2, 10.5, { align: 'center' });

            // Page indicator
            doc.setFontSize(7);
            doc.text('Page 1: VISION', pageWidth - margin, 7, { align: 'right' });

            // Layout: 4 columns
            const colGap = 3;
            const colWidth = (contentWidth - (colGap * 3)) / 4;
            const startY = headerHeight + 3;
            const availHeight = pageHeight - startY - 8;

            // Column positions
            const col1X = margin;
            const col2X = margin + colWidth + colGap;
            const col3X = margin + (colWidth + colGap) * 2;
            const col4X = margin + (colWidth + colGap) * 3;

            // Column 1: Core Values + Core Focus
            let y1 = startY;

            // Core Values
            const cvItems = (vtoData.coreValues || []).filter(v => v && v.trim());
            const cvHeight = Math.max(30, cvItems.length * 4 + 12);
            let cvY = drawSection('CORE VALUES', col1X, y1, colWidth, cvHeight);
            drawList(cvItems, col1X + 2, cvY, colWidth - 4, true);
            y1 += cvHeight + 2;

            // Core Focus
            const cfHeight = 45;
            let cfY = drawSection('CORE FOCUS', col1X, y1, colWidth, cfHeight);
            cfY = drawLabel('Purpose / Cause / Passion', col1X + 2, cfY);
            cfY = drawText(vtoData.purpose || '', col1X + 2, cfY, colWidth - 4);
            cfY += 2;
            cfY = drawLabel('Our Niche', col1X + 2, cfY);
            drawText(vtoData.niche || '', col1X + 2, cfY, colWidth - 4);
            y1 += cfHeight + 2;

            // 10-Year Target
            const tenHeight = 25;
            let tenY = drawSection('10-YEAR TARGET', col1X, y1, colWidth, tenHeight);
            if (vtoData.tenYearDate) {
                tenY = drawLabel('Target Date: ' + formatDate(vtoData.tenYearDate), col1X + 2, tenY);
            }
            drawText(vtoData.tenYearTarget || '', col1X + 2, tenY, colWidth - 4);

            // Column 2: 3-Year Picture
            let y2 = startY;
            const bullets = (vtoData.threeYearBullets || []).filter(b => b && b.trim());
            const threeHeight = Math.max(availHeight - 10, 80);
            let threeY = drawSection('3-YEAR PICTURE', col2X, y2, colWidth, threeHeight);

            if (vtoData.threeYearDate) {
                threeY = drawLabel('Date: ' + formatDate(vtoData.threeYearDate), col2X + 2, threeY);
            }
            if (vtoData.threeYearRevenue || vtoData.threeYearProfit) {
                doc.setTextColor(...darkGray);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'bold');
                if (vtoData.threeYearRevenue) {
                    doc.text(toAscii('Revenue: ' + vtoData.threeYearRevenue), col2X + 2, threeY);
                    threeY += 3;
                }
                if (vtoData.threeYearProfit) {
                    doc.text(toAscii('Profit: ' + vtoData.threeYearProfit), col2X + 2, threeY);
                    threeY += 3;
                }
            }
            threeY += 1;
            threeY = drawLabel('What Does It Look Like?', col2X + 2, threeY);
            drawList(bullets, col2X + 2, threeY, colWidth - 4);

            // Column 3 & 4: Marketing Strategy
            let y3 = startY;

            // Target Market (Col 3)
            const tmItems = (vtoData.targetMarket || []).filter(t => t && t.trim());
            const tmHeight = Math.max(35, tmItems.length * 4 + 15);
            let tmY = drawSection('TARGET MARKET', col3X, y3, colWidth, tmHeight);
            tmY = drawLabel('Demographics, Geographics, Psychographics', col3X + 2, tmY);
            drawList(tmItems, col3X + 2, tmY, colWidth - 4);
            y3 += tmHeight + 2;

            // Three Uniques (Col 3)
            const tuItems = (vtoData.threeUniques || []).filter(t => t && t.trim());
            const tuHeight = Math.max(35, tuItems.length * 4 + 12);
            let tuY = drawSection('THREE UNIQUES', col3X, y3, colWidth, tuHeight);
            drawList(tuItems, col3X + 2, tuY, colWidth - 4, true);
            y3 += tuHeight + 2;

            // Proven Process (Col 3)
            const ppHeight = 20;
            let ppY = drawSection('PROVEN PROCESS', col3X, y3, colWidth, ppHeight);
            drawText(vtoData.provenProcess || '', col3X + 2, ppY, colWidth - 4);

            // Column 4: Guarantee
            let y4 = startY;
            const gHeight = 30;
            let gY = drawSection('GUARANTEE', col4X, y4, colWidth, gHeight);
            drawText(vtoData.guarantee || '', col4X + 2, gY, colWidth - 4);

            // Footer
            doc.setTextColor(...medGray);
            doc.setFontSize(6);
            doc.text('Generated with VTO Builder', pageWidth / 2, pageHeight - 3, { align: 'center' });
            if (vtoData.vtoDate) {
                doc.text(toAscii('VTO Date: ' + formatDate(vtoData.vtoDate)), margin, pageHeight - 3);
            }

            // ==================== PAGE 2: TRACTION ====================
            doc.addPage([pageWidth, pageHeight], 'landscape');

            // Main header
            doc.setFillColor(...black);
            doc.rect(0, 0, pageWidth, headerHeight, 'F');
            doc.setTextColor(...white);
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('VISION/TRACTION ORGANIZER', pageWidth / 2, 7, { align: 'center' });
            doc.setFontSize(9);
            doc.setFont('helvetica', 'normal');
            doc.text(companyDisplay, pageWidth / 2, 10.5, { align: 'center' });
            doc.setFontSize(7);
            doc.text('Page 2: TRACTION', pageWidth - margin, 7, { align: 'right' });

            // 3-column layout for Traction
            const tColWidth = (contentWidth - (colGap * 2)) / 3;
            const tCol1X = margin;
            const tCol2X = margin + tColWidth + colGap;
            const tCol3X = margin + (tColWidth + colGap) * 2;

            // Column 1: 1-Year Plan
            y1 = startY;
            const goals = (vtoData.oneYearGoals || []).filter(g => g && g.trim());
            const oneYearHeight = availHeight - 5;
            let oyY = drawSection('1-YEAR PLAN', tCol1X, y1, tColWidth, oneYearHeight);

            if (vtoData.oneYearDate) {
                oyY = drawLabel('Date: ' + formatDate(vtoData.oneYearDate), tCol1X + 2, oyY);
            }
            if (vtoData.oneYearRevenue || vtoData.oneYearProfit) {
                doc.setTextColor(...darkGray);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'bold');
                if (vtoData.oneYearRevenue) {
                    doc.text(toAscii('Revenue: ' + vtoData.oneYearRevenue), tCol1X + 2, oyY);
                    oyY += 3;
                }
                if (vtoData.oneYearProfit) {
                    doc.text(toAscii('Profit: ' + vtoData.oneYearProfit), tCol1X + 2, oyY);
                    oyY += 3;
                }
            }
            if (vtoData.oneYearTheme) {
                oyY += 1;
                oyY = drawLabel('Theme: ' + vtoData.oneYearTheme, tCol1X + 2, oyY);
            }
            oyY += 1;
            oyY = drawLabel('Goals', tCol1X + 2, oyY);
            drawList(goals, tCol1X + 2, oyY, tColWidth - 4, true);

            // Column 2: Quarterly Rocks
            y2 = startY;
            const rocksFiltered = (vtoData.rocks || []).filter(r => r && r.text && r.text.trim());
            const rocksHeight = availHeight - 5;
            let qrY = drawSection('QUARTERLY ROCKS', tCol2X, y2, tColWidth, rocksHeight);

            if (vtoData.rocksDate) {
                qrY = drawLabel('Quarter End: ' + formatDate(vtoData.rocksDate), tCol2X + 2, qrY);
            }
            if (vtoData.rocksRevenue || vtoData.rocksProfit) {
                doc.setTextColor(...darkGray);
                doc.setFontSize(8);
                doc.setFont('helvetica', 'bold');
                if (vtoData.rocksRevenue) {
                    doc.text(toAscii('Revenue: ' + vtoData.rocksRevenue), tCol2X + 2, qrY);
                    qrY += 3;
                }
                if (vtoData.rocksProfit) {
                    doc.text(toAscii('Profit: ' + vtoData.rocksProfit), tCol2X + 2, qrY);
                    qrY += 3;
                }
            }
            if (vtoData.rocksTheme) {
                qrY += 1;
                qrY = drawLabel('Theme: ' + vtoData.rocksTheme, tCol2X + 2, qrY);
            }
            qrY += 1;

            // Draw rocks with owners
            doc.setTextColor(...darkGray);
            doc.setFontSize(8);
            rocksFiltered.forEach((rock, index) => {
                const rockText = `${index + 1}. ${toAscii(rock.text)}`;
                const ownerText = rock.owner ? ` (${toAscii(rock.owner)})` : '';
                const lines = doc.splitTextToSize(rockText + ownerText, tColWidth - 6);
                doc.text(lines, tCol2X + 2, qrY);
                qrY += lines.length * 3 + 1;
            });

            // Column 3: Issues List
            y3 = startY;
            const issuesFiltered = (vtoData.issues || []).filter(i => i && i.text && i.text.trim());
            const issuesHeight = availHeight - 5;
            let issY = drawSection('ISSUES LIST', tCol3X, y3, tColWidth, issuesHeight);

            doc.setFontSize(8);
            issuesFiltered.forEach((issue, index) => {
                doc.setTextColor(...darkGray);
                const issueText = `${index + 1}. ${toAscii(issue.text)}`;
                const lines = doc.splitTextToSize(issueText, tColWidth - 25);
                doc.text(lines, tCol3X + 2, issY);

                if (issue.status) {
                    doc.setFontSize(6);
                    let statusColor;
                    switch(issue.status) {
                        case 'DONE': statusColor = [16, 185, 129]; break;
                        case 'IN PROGRESS': statusColor = [245, 158, 11]; break;
                        case 'NEED': statusColor = [239, 68, 68]; break;
                        default: statusColor = medGray;
                    }
                    doc.setTextColor(...statusColor);
                    doc.setFont('helvetica', 'bold');
                    doc.text(issue.status, tCol3X + tColWidth - 3, issY, { align: 'right' });
                    doc.setFont('helvetica', 'normal');
                    doc.setFontSize(8);
                }
                issY += lines.length * 3 + 2;
            });

            // Footer
            doc.setTextColor(...medGray);
            doc.setFontSize(6);
            doc.text('Generated with VTO Builder', pageWidth / 2, pageHeight - 3, { align: 'center' });
            if (vtoData.vtoDate) {
                doc.text(toAscii('VTO Date: ' + formatDate(vtoData.vtoDate)), margin, pageHeight - 3);
            }

            // Save with sanitized filename
            const safeName = sanitizeFilename(vtoData.companyName);
            doc.save(`VTO-${safeName}-${new Date().toISOString().split('T')[0]}.pdf`);
            showToast('PDF exported successfully', 'success');
        }

        // Auto-save on input changes
        document.addEventListener('input', () => {
            collectFormData();
        });

        // Initialize on load
        document.addEventListener('DOMContentLoaded', () => {
            // Set default VTO date to today
            document.getElementById('vtoDate').valueAsDate = new Date();
            loadFromLocalStorage();
        });
    </script>
</body>
</html>
